---
title: "Compare polygons to points"
author: "Eleanor Jackson"
date: '14 February, 2023'
always_allow_html: true
output: 
  github_document:
    keep_html: true
---

```{r setup, include = FALSE}
file_name <- rstudioapi::getSourceEditorContext()$path

knitr::opts_chunk$set(
  fig.path =
    paste0("figures/", sub("\\.Rmd$", "", basename(file_name)), "/", sep = "")
)

ggplot2::theme_set(ggplot2::theme_classic(base_size = 10))
```

Carol has given us polygons for the Jacaranda so that we can calculate crown area.
But she has said that the polygon data is older than the point data - 
lets see how many trees have been recruited or have died in-between these two time points.

```{r, message=FALSE, warning=FALSE}
library("tidyverse")
library("here")
library("sf")
```

```{r}
st_read(here::here(
  "data", "maps",
  "jacc-map-garzonlopez2012", "JAC1COpointSept.shp"
)) %>% 
  filter(!st_is_empty(.)) -> point_data

st_read(here::here(
  "data", "maps",
  "polygons-garzonlopez2008", "JAC1CO_pol2008.shp"
)) %>% 
  filter(!st_is_empty(.)) -> polygon_data

```

The polygon data has `r nrow(polygon_data)` rows and the point data has `r nrow(point_data)` rows - `r nrow(polygon_data) - nrow(point_data)` fewer.

```{r warning=FALSE}
st_join(polygon_data, point_data, join = st_within, largest = TRUE, left = FALSE) %>% 
  nrow()
```

There are 960 trees that are in both datasets.
To calculate the number of trees that have died we can do `r nrow(polygon_data)` - 960 = 26.
The number that have been recruited is `r nrow(point_data)` - 960 = 17.

We don't want to include any dead trees in our dataset so will have to use 
the crown sizes of the trees that appear in both datasets. 
For the trees in the point data for which we don't have polygons, 
we could use an average crown size?